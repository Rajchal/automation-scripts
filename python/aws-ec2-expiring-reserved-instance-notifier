import boto3
from datetime import datetime, timezone, timedelta

THRESHOLD_DAYS = 30
ec2 = boto3.client('ec2')

def main():
    reservations = ec2.describe_reserved_instances()['ReservedInstances']
    for r in reservations:
        if r['State'] != 'active':
            continue
        expiry = r['End']
        days_left = (expiry - datetime.now(timezone.utc)).days
        if days_left < THRESHOLD_DAYS:
            print(f"Reserved Instance {r['ReservedInstancesId']} expires in {days_left} days")

if __name__ == "__main__":
    main()
